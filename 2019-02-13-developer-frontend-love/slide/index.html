<html>
    <head>
        <link
            rel="stylesheet"
            href="../asset/vendor/reveal.js-3.7.0/css/reveal.css"
        />
        <link rel="stylesheet" href="../asset/vendor/prism-1.15.0/prism.css" />
        <link rel="stylesheet" href="../asset/peerigon/theme-peerigon.css" />
    </head>
    <body id="peerigon">
        <div class="reveal">
            <div class="slides">
                <section
                    id="first-slide"
                    data-background-image="../asset/amsterdam.jpg"
                    data-background-color="black"
                    data-background-opacity="0.5"
                >
                    <style>
                        #first-slide h1 {
                            color: white;
                        }

                        #first-slide .credit {
                            font-size: 1rem;
                            position: fixed;
                            bottom: 10px;
                            opacity: 0.5;
                        }
                    </style>
                    <div class="kicker">Developer Frontend Love</div>
                    <h1>The future of JavaScript bundlers.</h1>
                    <span class="credit">
                        Photo by azhrjl on Unsplash
                    </span>
                </section>
                <section>
                    <section data-background-color="var(--color-whiskey-bg)">
                        <h2>About me</h2>
                    </section>
                    <section>
                        <div style="text-align: center">
                            <img
                                src="../asset/me/me.svg"
                                style="width: 100%;"
                                alt="Image of Johannes Ewald"
                            />
                        </div>
                    </section>
                    <section>
                        <div style="text-align: center">
                            <img
                                src="../asset/peerigon/peerigon-logo-flat-whiskey.svg"
                                width="600"
                                alt="Peerigon logo"
                            />
                        </div>
                    </section>
                    <section>
                        <div style="text-align: center">
                            <img
                                src="../asset/me/webpack-logo.svg"
                                width="700"
                                alt="Webpack logo"
                            />
                        </div>
                    </section>
                </section>
                <section>
                    <section data-background-color="var(--color-whiskey-bg)">
                        <h2>Do we even need JavaScript bundlers?</h2>
                        <!-- TODO: Idea: Amsterdam image -->
                    </section>
                    <section>
                        <div class="kicker">
                            Problems with JavaScript bundlers
                        </div>
                        <h3>There is a build step.</h3>
                        <ul>
                            <li class="fragment">Might be slow</li>
                            <li class="fragment">Adds additional complexity</li>
                        </ul>
                    </section>
                    <section>
                        <div class="kicker">
                            Problems with JavaScript bundlers
                        </div>
                        <h3>You have to configure it.</h3>
                        <ul>
                            <li class="fragment">
                                For special dialects like JSX or CSS modules
                            </li>
                            <li class="fragment">#0CJS is a good start...</li>
                            <li class="fragment">
                                ...but every reasonable-sized app will
                                eventually require custom configuration
                            </li>
                        </ul>
                    </section>
                    <section>
                        <div class="kicker">
                            Problems with JavaScript bundlers
                        </div>
                        <h3>Additional indirection.</h3>
                        <ul>
                            <li class="fragment">
                                The code you write is not the code that is
                                executed
                            </li>
                            <li class="fragment">
                                Configuring source maps can be error prone
                            </li>
                            <li class="fragment">
                                Source maps are slow to generate
                            </li>
                        </ul>
                    </section>
                    <section>
                        <p>
                            You suddenly have to deal with problems you didn't
                            have before.
                        </p>
                    </section>
                    <section>
                        <h3>Native ES modules support in browsers</h3>
                        <p>
                            <!-- TODO: Add caniuse -->
                        </p>
                    </section>
                    <section>
                        <p>
                            Why isn't everyone just using ES modules?
                        </p>
                    </section>
                    <section>
                        <div style="text-align: center">
                            <img
                                src="../asset/bare-specifier-error.jpg"
                                alt="Image of a resolve module error"
                                width="900"
                            />
                        </div>
                    </section>
                    <section>
                        <h3>No bare module specifiers.</h3>
                        <pre data-src="../example/bareModuleSpecifier.js"></pre>
                    </section>
                    <section>
                        <h3>No optional extensions.</h3>
                        <pre data-src="../example/optionalExtension.js"></pre>
                    </section>
                    <section>
                        <h3>No <code>package.json</code> resolving.</h3>
                        <pre
                            data-src="../example/packageJsonResolving.json"
                        ></pre>
                    </section>
                    <section>
                        <p>
                            Since URL lookups are expensive, the browser can't
                            just try out a bunch of possibilities like Node.js
                            does.
                        </p>
                    </section>
                    <section>
                        <p>
                            Will we still need JavaScript bundlers in the
                            future?
                        </p>
                    </section>
                </section>
                <section>
                    <section data-background-color="var(--color-whiskey-bg)">
                        <h2>The purpose of JavaScript bundlers.</h2>
                    </section>
                    <section id="feature-table-1">
                        <style>
                            #feature-table-1 tbody {
                                visibility: hidden;
                            }
                        </style>
                        <feature-table></feature-table>
                    </section>
                    <section>
                        <div class="kicker">Dev experience</div>
                        <h3>
                            They enable JavaScript modules in all browsers.
                        </h3>
                        <!-- TODO: Fix headline line-height -->
                        <!--TODO: Hooray emojii? -->
                    </section>
                    <section>
                        <div class="kicker">Dev experience</div>
                        <h3>HTML, CSS and WebAssembly modules.</h3>
                    </section>
                    <section>
                        <div class="kicker">Dev experience</div>
                        <h3>
                            They allow us to use custom languages.
                        </h3>
                        <ul>
                            <li class="fragment">JSX</li>
                            <li class="fragment">Vue Single-File Components</li>
                            <li class="fragment">TypeScript</li>
                        </ul>
                    </section>
                    <section>
                        <div class="kicker">Dev experience</div>
                        <h3>Short feedback loop.</h3>
                        <ul>
                            <li class="fragment">
                                Fast rebuilds in watch mode
                            </li>
                            <li class="fragment">Hot module replacement</li>
                            <!--TODO: Hooray emojii? -->
                        </ul>
                    </section>
                    <section id="feature-table-2">
                        <style>
                            #feature-table-2 tbody tr td:not(:first-child) {
                                visibility: hidden;
                            }
                        </style>
                        <feature-table></feature-table>
                    </section>
                    <section>
                        <div class="kicker">Compatibility</div>
                        <h3>They unify module systems.</h3>
                        <p class="fragment">
                            Like ESM, CJS, even WASM and mabe even still AMD.
                        </p>
                    </section>
                    <section>
                        <p>
                            They take care of...
                        </p>
                        <ul>
                            <li class="fragment">
                                ...wiring all imports and exports together
                            </li>
                            <li class="fragment">
                                ...initializing the module graph
                            </li>
                        </ul>
                        <p class="fragment">
                            You don't need to worry about what module system
                            your dependencies are using.
                        </p>
                    </section>
                    <section>
                        <div class="kicker">Compatibility</div>
                        <h3>They unify the underlying platform.</h3>
                        <p class="fragment">
                            Historically, we tried to simulate a CJS environment
                            with Node.js core modules.
                        </p>
                    </section>
                    <section>
                        <div class="kicker">Compatibility</div>
                        <h3>They compile down new language features.</h3>
                        <p class="fragment">
                            Via build tools like Babel and PostCSS.
                        </p>
                    </section>
                    <section id="feature-table-3">
                        <style>
                            #feature-table-3 tbody tr td:nth-child(3) {
                                visibility: hidden;
                            }
                        </style>
                        <feature-table></feature-table>
                    </section>
                    <section>
                        <div class="kicker">Optimization</div>
                        <h3>They create efficient chunks.</h3>
                        <ul>
                            <li class="fragment">
                                By resolving module ids on build time
                            </li>
                            <li class="fragment">
                                By merging modules that depend on each other
                                into a single file.
                            </li>
                        </ul>
                    </section>
                    <section>
                        <div class="kicker">Optimization</div>
                        <h3>
                            They allow us to do effective long-term caching.
                        </h3>
                        <p class="fragment">
                            By calculating asset hashes and automatically
                            updating all URLs.
                        </p>
                    </section>
                    <section>
                        <div class="kicker">Optimization</div>
                        <h3>They add resource hints for the browser.</h3>
                    </section>
                    <section>
                        <div class="kicker">Optimization</div>
                        <h3>They reduce asset file sizes.</h3>
                        <p class="fragment">
                            By removing...
                        </p>
                        <ul>
                            <li class="fragment">
                                unused code (a.k.a. tree-shaking and dead code
                                elimination)
                            </li>
                            <li class="fragment">
                                redundant characters (minification)
                            </li>
                            <li class="fragment">
                                unnecessary bytes (compression)
                            </li>
                        </ul>
                    </section>
                    <section>
                        <p>
                            <strong>Well...</strong>
                        </p>
                        <p>
                            ...they don't actually do the latter, but they
                            orchestrate other tools which do that.
                        </p>
                    </section>
                    <section id="feature-table-4">
                        <feature-table></feature-table>
                    </section>
                </section>
                <section>
                    <section data-background-color="var(--color-whiskey-bg)">
                        <h2>The future of JavaScript bundlers.</h2>
                    </section>
                    <section>
                        <div class="kicker">Dev experience</div>
                        <h3>
                            JS modules.
                        </h3>
                        <p class="fragment">
                            We don't need JS bundlers for that, it's already
                            possible with ESM.
                        </p>
                        <p class="fragment">
                            <strong>But:</strong> our current problem is
                            resolving.
                        </p>
                    </section>
                    <section>
                        <p>
                            Things we can do:
                            <span class="fragment"
                                >not rely on
                                <a
                                    href="https://www.youtube.com/watch?v=M3BM9TB-8yA"
                                    target="_blank"
                                    >"cute" (Ryan Dahl)</a
                                >
                                resolving features.</span
                            >
                        </p>
                    </section>
                    <section>
                        <ul>
                            <li>
                                Use file extensions
                            </li>
                            <li class="fragment">
                                Use the <code>.mjs</code> extension for
                                JavaScript modules once ESMs land in Node.js
                            </li>
                            <li class="fragment">
                                Avoid <code>index.js</code>
                            </li>
                            <li class="fragment">
                                Avoid module aliases just for ergonomic reasons
                            </li>
                        </ul>
                    </section>
                    <section
                        id="real-path"
                        data-background-video="../asset/mind-blown.mp4"
                        data-background-video-loop
                        data-background-opacity="0.3"
                        data-background-color="black"
                    >
                        <style>
                            #real-path h3 {
                                color: white;
                            }
                        </style>
                        <strong>
                            Just use the real path.
                        </strong>
                    </section>
                    <section>
                        <h3>
                            But do we really have to give up bare module
                            specifiers (BMS)?
                        </h3>
                    </section>
                    <section>
                        <p>
                            Advantages of BMS:
                        </p>
                        <ul>
                            <li class="fragment">
                                Shorter imports for common packages
                            </li>
                            <li class="fragment">
                                Indirection at package-level which allows the
                                main/browser switch.
                                <small
                                    >This is important for isomorphic modules
                                    like <code>isomorphic-fetch</code>.</small
                                >
                            </li>
                            <li class="fragment">
                                Hides the actual file layout of third-party
                                modules
                            </li>
                        </ul>
                    </section>
                    <section>
                        <p>
                            There are two ways we could get BMS into the
                            browser:
                        </p>
                        <ul>
                            <li class="fragment">
                                A strict and universal standard how to look up
                                BMS (and all packages would need to adhere to
                                it)
                            </li>
                            <li class="fragment">
                                An external resolving config (out-of-band
                                configuration)
                            </li>
                        </ul>
                    </section>
                    <section data-background-image="../asset/import-maps.jpg"></section>
                    <section>
                        <pre data-src="../example/importMapsSimple.html"></pre>
                    </section>
                    <section>
                        <p>
                            You can also define fallbacks:
                        </p>
                        <pre
                            data-src="../example/importMapsFallback.html"
                        ></pre>
                    </section>
                    <section>
                        <p>
                            There are also scopes that allow to map a BMS to
                            different locations depending on the importing
                            module:
                        </p>
                        <pre data-src="../example/importMapsScope.html"></pre>
                    </section>
                    <section>
                        <h3>
                            But do we have to groom these import maps by hand?
                        </h3>
                    </section>
                    <section>
                        <p>
                            <strong>No.</strong> It will probably be generated
                            by package managers.
                        </p>
                        <p class="fragment">
                            But we will need to tweak it once in a while.
                        </p>
                    </section>
                    <section>
                        <feature-table>
                            <check-mark class="fragment" slot="js-modules" ok />
                        </feature-table>
                    </section>
                    <section data-background-image="../asset/html-modules.jpg"></section>
                    <section>
                        <p>
                            As a replacement for <a href="https://w3c.github.io/webcomponents/spec/imports/" target="_blank">HTML imports</a>:
                        </p>
                        <pre data-src="../example/htmlModuleSimple.html"></pre>
                        <pre data-src="../example/htmlModuleSimple.js"></pre>
                    </section>
                    <section class="fullscreen-code">
                        <pre data-src="../example/htmlModuleAdvanced.html"></pre>
                    </section>
                    <section>
                        <pre data-src="../example/htmlModuleAdvanced.js"></pre>
                    </section>
                </section>
            </div>
        </div>
        <style>
        #peerigon .reveal .fullscreen-code pre {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            margin: 0;
        }

        #peerigon .reveal .fullscreen-code code {
            max-height: none;
        }
        </style>
        <template id="feature-table">
            <style>
                table {
                    margin: auto;
                    border-collapse: collapse;
                    border-spacing: 0;
                }

                table th {
                    font-weight: bold;
                    font-size: 2rem;
                }

                table th,
                table td {
                    text-align: left;
                    padding: 0.2em 0.5em 0.2em 0.5em;
                    border-bottom: 1px solid;
                }

                table tbody tr:last-child th,
                table tbody tr:last-child td {
                    border-bottom: none;
                }
                td > div {
                    display: flex;
                    justify-content: space-between;
                }
            </style>
            <table>
                <thead>
                    <tr>
                        <th>Dev experience</th>
                        <th>Compatibility</th>
                        <th>Optimization</th>
                    </tr>
                </thead>
                <tbody style="font-size: 2rem">
                    <tr>
                        <td>
                            <div>
                                <span>JS modules</span>
                                <span><slot name="js-modules">&nbsp;</slot></span>
                            </div>
                        </td>
                        <td>
                            <div>
                                <span>Unified module systems</span>
                                <span><slot name="unified-module-system">&nbsp;</slot></span>
                            </div>
                        </td>
                        <td>
                            <div>
                                <span>Efficient chunks</span>
                                <span><slot name="efficient-chunks">&nbsp;</slot></span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div>
                                <span>HTML, CSS & WASM modules</span>
                                <span><slot name="html-css-wasm-modules">&nbsp;</slot></span>
                            </div>
                        </td>
                        <td>
                            <div>
                                <span>Unified platform</span>
                                <span><slot name="unified-platform">&nbsp;</slot></span>
                            </div>
                        </td>
                        <td>
                            <div>
                                <span>Long-term caching</span>
                                <span><slot name="long-term-caching">&nbsp;</slot></span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div>
                                <span>Custom languages</span>
                                <span><slot name="custom-languages">&nbsp;</slot></span>
                            </div>
                        </td>
                        <td>
                            <div>
                                <span>New language features</span>
                                <span><slot name="new-language-features">&nbsp;</slot></span>
                            </div>
                        </td>
                        <td>
                            <div>
                                <span>Resource hints</span>
                                <span><slot name="resource-hints">&nbsp;</slot></span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div>
                                <span>Short feedback loop</span>
                                <span><slot name="short-feedback-loop">&nbsp;</slot></span>
                            </div>
                        </td>
                        <td></td>
                        <td>
                            <div>
                                <span>Smaller file sizes</span>
                                <span><slot name="smaller-file-sizes">&nbsp;</slot></span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </template>
        <script>
            class FeatureTable extends HTMLElement {
                constructor() {
                    super();
                    const template = document.getElementById("feature-table");

                    this.attachShadow({ mode: "open" }).appendChild(
                        template.content.cloneNode(true)
                    );
                }
            }

            window.customElements.define("feature-table", FeatureTable);
        </script>
        <template id="checkmark">
            <span style="color: #0b8649">✔</span>
        </template>
        <script>
            class Checkmark extends HTMLElement {
                constructor() {
                    const ok = 0;
                    const maybe = 1;
                    const problem = 2;

                    super();
                    const template = document.getElementById("checkmark");

                    this.appendChild(template.content.children[ok].cloneNode(true));
                }
            }

            window.customElements.define("check-mark", Checkmark);
        </script>
        <script src="../asset/vendor/prism-1.15.0/prism.js"></script>
        <script src="../asset/vendor/reveal-alt-arrows/alt-arrows.js"></script>
        <script src="../asset/vendor/reveal.js-3.7.0/js/reveal.js"></script>
        <script src="../asset/peerigon/colorScheme.js"></script>
        <script>
            Reveal.initialize({
                history: true,
                keyboard: {
                    39: "next", // Right Arrow
                    37: "prev", // Left Arrow
                },
            });
        </script>
    </body>
</html>
